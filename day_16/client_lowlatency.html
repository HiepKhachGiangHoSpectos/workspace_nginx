<!doctype html>
<html>
<body>
<h2>Low-latency push client</h2>
<button onclick="connect()">Connect WS</button>
<pre id="log"></pre>

<script>
    function log(s){ document.getElementById('log').textContent += s + "\n"; }
    let ws;
    function connect(){
        if (ws && ws.readyState === WebSocket.OPEN) {
            console.log('Already connected');
            return;
        }
        ws = new WebSocket("ws://localhost:8216/lowlatency/ws"); // qua nginx
        ws.onopen = () => { console.log('WS open'); };
        ws.onmessage = (e) => {
            try {
                const msg = JSON.parse(e.data);
                if (msg.type === 'update') {
                    log('UPDATE: ' + JSON.stringify(msg.data));
                } else {
                    log('MSG: ' + e.data);
                }
            } catch {
                log('RAW: ' + e.data);
            }
        };
        ws.onclose = () => console.log('WS closed');
        ws.onerror = (err) => console.log('WS error ' ,err);
    }
</script>
</body>
</html>
