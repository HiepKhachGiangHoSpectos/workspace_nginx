<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Polling vs WS</title>
</head>
<body>
<h1>Test Polling vs WebSocket</h1>

<button id="startPolling">Start Polling</button>
<div id="pollingData"></div>

<button id="connectWS">Connect WebSocket</button>
<div id="wsData"></div>

<script>
    const pollingData = document.getElementById('pollingData');
    const wsData = document.getElementById('wsData');

    document.getElementById('startPolling').onclick = () => {
        setInterval(async () => {
            const res = await fetch('http://localhost:8216/polling/data');
            const json = await res.json();
            pollingData.textContent = 'Polling: ' + JSON.stringify(json);
        }, 2000);
    };

    document.getElementById('connectWS').onclick = () => {
        const ws = new WebSocket('ws://localhost:8216/polling/ws');
        ws.onopen = () => ws.send('hello');

        ws.onmessage = e => {
            try {
                // parse JSON broadcast
                const data = JSON.parse(e.data);
                wsData.innerHTML += `<div>WS broadcast: ${data.value} at ${data.time}</div>`;
            } catch {
                // echo string
                wsData.innerHTML += `<div>${e.data}</div>`;
            }
        };
    };
</script>

</body>
</html>
